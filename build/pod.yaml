apiVersion: v1
kind: Pod
metadata:
  name: moneybook-pod
spec:
  restartPolicy: Always
  volumes:
  - name: nginx-config
    configMap:
      name: moneybook-nginx-config
  - name: static-files
    emptyDir: {}
  
  containers:
  - name: gunicorn
    image: localhost/moneybook_gunicorn:latest
    env:
    - name: DB_NAME
      value: "${DB_NAME}"
    - name: DB_USER
      value: "${DB_USER}"
    - name: DB_PASS
      value: "${DB_PASS}"
    - name: DB_HOST
      value: "${DB_HOST}"
    - name: HOST_NAME
      value: "${HOST_NAME}"
    - name: SECRET_KEY
      value: "${SECRET_KEY}"
    ports:
    - containerPort: 8081
      protocol: TCP
    volumeMounts:
    - name: static-files
      mountPath: /shared-static
    
  - name: nginx
    image: docker.io/nginx:alpine
    ports:
    - containerPort: 80
      hostPort: 8081
      protocol: TCP
    volumeMounts:
    - name: nginx-config
      mountPath: /etc/nginx/conf.d
      readOnly: true
    - name: static-files
      mountPath: /usr/share/nginx/html/static
      readOnly: true
